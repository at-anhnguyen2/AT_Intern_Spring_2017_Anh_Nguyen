<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <title>HOME</title>
</head>
<body>
  <!-- header -->
  <header class="header">
    <div class="header-logo">
      <img src="img/logo.png" alt="LOGO">
    </div>
    <div>
      <div class="right-header">
        <img src="img/telephone.png" alt="TEL">
        <div>
          <p>Chăm sóc khách hàng</p>
          <p class="phone-number">1900 6068</p>
        </div>
        <img src="img/com.png" alt="COM">
        <div>
          <p>Chăm sóc khách hàng ngoài giờ</p>
          <p>
            <span>Khách sạn:</span>
            <span class="phone-number">0906 636 171</span> 
            <span>/ Tour:</span> 
            <span class="phone-number">0938 238 004</span></p>
        </div>
      </div>
      <nav class="top-menu">
        <a href="#">TRANG CHỦ</a>
        <a href="#">VỀ HADATOUR</a>
        <a href="#">TOUR</a>
        <a href="#">KHÁCH SẠN</a>
        <a href="#">CHO THUÊ PHƯƠNG TIỆN</a>
        <a href="#">VÉ MÁY BAY</a>
        <a href="#">TIN TỨC</a>
        <a href="#">LIÊN HỆ</a>
      </nav>
    </div>
  </header>
  <!-- banner -->
  <section class="banner">
    <div class="banner-text">
      <p>trải nghiệm thú vị</p> 
      <p class="line2">Thoả sức khám phá</p>
    </div>
  </section>

  <!-- content -->
  <section class="content">
    <h1>TOUR</h1>
    <div class="categories">
      <div class="item-category" category-text="Tour nổi bật">
        <!-- Tour nổi bật -->
      </div>
      <div class="item-category" category-text="Tour nước ngoài">
        <!-- Tour nước ngoài -->
      </div>
      <div class="item-category" category-text="Tour trong nước">
        <!-- Tour trong nước -->
      </div>
    </div>
    <main>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 01</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">3.500.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn1">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 02</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">4.200.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn2">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 03</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">5.000.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn3">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 04</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">5.500.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn4">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 05</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">3.500.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn5">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 06</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">4.200.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn6">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 07</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">5.000.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn7">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 08</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">5.500.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn8">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 09</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">3.500.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn9">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 10</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">4.200.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn10">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 11</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">5.000.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn11">Book</button>
      </div>
      <div class="container">
        <img src="img/img-detail.png" alt="Image">
        <div>
          <p class="tour-name">Tour 12</p>
          <p>
            <span>Giá Tour: </span>
            <span class="price">5.500.000 VNĐ</span>
          </p>  
        </div>
        <button type="button" name="btn" class="book-btn" id="btn12">Book</button>
      </div>
      
    </main>
  </section>

  <!-- book tour -->
  <div class="tour-booked">
    <h3>Number of tour <br>booked</h3>
    <p id="number-of-tour">
      
    </p>
  </div>

  <!-- tout booked table -->
  <div class="tour-booked-info">
    <table class="table">
    <caption>BOOKED TOUR LIST</caption>
      <thead>
        <tr>
          <th class="th1">Tour name</th>
          <th class="th2">Unit Price</th>
          <th class="th3">Quantity</th>
          <th class="th4">Sub Total</th>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <td colspan="2">Total</td>
          <td id="total-tour"></td>
          <td id="total-price"></td>
        </tr>
      </tfoot>
      <tbody id="show-tour">
        <!-- table content -->
        
      </tbody>
    </table>
    <button type="button" id="btn-back"> < Back </button>
    <button type="button" id="btn-pay">Pay</button>
  </div>

  <div id="overlay-body">
    
  </div>

  <!-- footer -->
  <footer class="footer">
    <div class="contact">
      <div class="footer-logo">
        <img src="img/logo.png" alt="LOGO">
      </div>
      <div class="info">
        <h3>THÔNG TIN</h3>
        <p>Giới thiệu về HadaTour</p>
        <p>Thông tin liên hệ</p>
        <p>Điều khoản thành viên</p>
        <p>Phương thức thanh toán</p>
        <p>Tuyên dụng</p>
      </div>
      <div class="community">
        <h3>CỘNG ĐỒNG</h3>
        <p>Facebook</p>
        <p>Google+</p>
        <p>Twitter</p>
        <p>Youtube</p>
      </div>
      <div class="input-email">
        <p>Nhập Email để nhận giá tốt từ HadaTour</p>
        <div>
          <input type="text" placeholder="Nhập địa chỉ Email">
          <button type="button">ABC</button>
        </div>
      </div>
    </div>
    <div class="license">
      <div>2015 - Bản quyền thuộc về HadaTour</div>
    </div>
  </footer>

  <!-- Script -->
  <script type="text/javascript">
    var $btn = document.getElementsByName('btn');
    var $numberOfTour = document.getElementById('number-of-tour');
    var $tourName = document.getElementsByClassName('tour-name');
    var $tourPrice = document.getElementsByClassName('price');
    var $arrayIsBooked = [];
    var $arrayTourBooked = [];
    var $tableTourBooked = document.getElementsByClassName('tour-booked-info');
    var $tfootTour = document.getElementById('total-tour');
    var $tfootTotal = document.getElementById('total-price');
    var $pay = document.getElementById('btn-pay');
    var $back = document.getElementById('btn-back');
    var $overlayBody = document.getElementById('overlay-body');

    // load local Storage
    if(typeof(Storage) !== "undefined"){
      checkLocalStorage();
      loadLocalStorage();
    }
    else{
      alert("Brower does not support web storage...");
    }

    // create event click for button Book
    for (var i = 0, len = $btn.length; i < len; i++) {
      $btn[i].addEventListener('click', function(e) {
        j = String(e.target.id).substring(3);
        j = Number(j) - 1;
        if($arrayIsBooked[j] == false){
          localStorage.countTour = Number(localStorage.countTour) + 1;
          $arrayIsBooked[j] = true;
          $tourHash = {name: $tourName[j].innerHTML, price: $tourPrice[j].innerHTML};
          $arrayTourBooked.push($tourHash);
        }
        $numberOfTour.innerHTML = localStorage.countTour;
        localStorage.isTourBooked = JSON.stringify($arrayIsBooked);
        localStorage.listTour = JSON.stringify($arrayTourBooked);
      });
    }

    // click number of tour
    $numberOfTour.addEventListener('click', function() {
      $tableTourBooked[0].style = "visibility: visible; z-index: 20";
      $overlayBody.style = "background: rgba(0, 0, 0, 0.4); z-index: 10";
      loadTable();
    });

    //click button pay
    $pay.addEventListener('click', function() {
      alert("Paying Success!!!!");
      $tableTourBooked[0].style = "visibility: hidden; z-index: -20";
      $overlayBody.style = "background: transparent; z-index: -10";
      localStorage.clear();
      $arrayIsBooked = [];
      $arrayTourBooked = [];
      removeTable();
      checkLocalStorage();
      loadLocalStorage();
    });

    //click button back
    $back.addEventListener('click', function(){
      $tableTourBooked[0].style = "visibility: hidden; z-index: -20";
      $overlayBody.style = "background: transparent; z-index: -10";
      removeTable();
      loadLocalStorage();
    });

    function checkLocalStorage(){
      if(!localStorage.countTour){
        localStorage.countTour = 0; 
      }
      if (!localStorage.isTourBooked) {
        for (var i = 0, len = $btn.length; i < len; i++) {
          $arrayIsBooked.push(false);
        }
        localStorage.isTourBooked = JSON.stringify($arrayIsBooked);
      }
      if (!localStorage.listTour) {
        localStorage.listTour = JSON.stringify($arrayTourBooked);
      }
    }

    function loadLocalStorage(){
      $numberOfTour.innerHTML = localStorage.countTour;
      $arrayIsBooked = JSON.parse(localStorage.isTourBooked);
      $arrayTourBooked = JSON.parse(localStorage.listTour);
    }

    function loadTable(){
      var $showTour = document.getElementById('show-tour');
      var $arrayTour = JSON.parse(localStorage.listTour);
      for (var i = 0, len = $arrayTour.length; i < len; i++) {
        //create Elements in table
        var $tr = document.createElement('tr');
        var $tdName = document.createElement('td');
        var $tdPrice = document.createElement('td');
        $tdPrice.className = "tbody-price";
        var $tdQuantity = document.createElement('td');
        var $inputQuantity = document.createElement('input');
        $inputQuantity.className = "tbody-quantity";
        $inputQuantity.type = "text";
        $inputQuantity.value = "1";
        var $tdTotal = document.createElement('td');
        $tdTotal.className = "tbody-total";

        //add value
        $tdName.innerHTML = $arrayTour[i].name;
        $strPrice = String($arrayTour[i].price);
        $tdPrice.innerHTML = $strPrice.substring(0, $strPrice.length - 4).split(".").join(",");
        $tdQuantity.appendChild($inputQuantity);
        $tdTotal.innerHTML = normalNumber($tdPrice.innerHTML) * Number($inputQuantity.value);
        $tdTotal.innerHTML = commasNumber($tdTotal.innerHTML);

        //table appendChild
        $tr.appendChild($tdName);
        $tr.appendChild($tdPrice);
        $tr.appendChild($tdQuantity);
        $tr.appendChild($tdTotal);
        $showTour.appendChild($tr);

        //Change Quantity
        $inputQuantity.addEventListener('change', function(e) {
          //update subTotal
          $currentRowPrice = e.path[2].childNodes[1].innerHTML;
          $currentRowTotal = normalNumber($currentRowPrice) * Number(e.target.value);
          e.path[2].childNodes[3].innerHTML = commasNumber($currentRowTotal);
          //update Total
          updateTotal();
        });
      }
      updateTotal();
    }

    function removeTable(){
      var $showTour = document.getElementById('show-tour');
      while ($showTour.hasChildNodes()) {
        $showTour.removeChild($showTour.firstChild);
      }
    }
    
    function updateTotal(){
      var $arrayTotal = document.getElementsByClassName('tbody-total');
      var $arrayCountTour = document.getElementsByClassName('tbody-quantity');
      var $sumPrice = 0, $sumTour = 0;
      for (var i = 0, len = $arrayTotal.length; i < len; i++) {
        $sumPrice += normalNumber($arrayTotal[i].innerHTML);
        $sumTour += Number($arrayCountTour[i].value);
      }
      $tfootTotal.innerHTML = commasNumber($sumPrice);
      $tfootTour.innerHTML = $sumTour;
    }

    function commasNumber(number){
      return String(number).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function normalNumber(string){
      return Number(string.split(",").join(""));
    }
  </script>
</body>
</html>